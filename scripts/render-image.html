{{- /*
  render-image.html
  MD内の画像参照を公開URLに変換するRender Hook

  入力（.Destination）の例:
    attachments/2026-02-20-test-article3--hero-01.jpg

  出力URLの例:
    /blog/2026-02-20-test-article3/hero-01.webp

  変換ルール:
    1. "attachments/" プレフィックスを除去してファイル名を取得
    2. "--" でスラグとnameに分割
    3. 拡張子を .webp に変換
    4. /{section}/{slug}/{name}.webp の形式でURLを組み立て
*/ -}}

{{- $dest := .Destination -}}
{{- $src := $dest -}}

{{- if hasPrefix $dest "attachments/" -}}
  {{- $filename := strings.TrimPrefix "attachments/" $dest -}}
  {{- $nameNoExt := strings.TrimSuffix (path.Ext $filename) $filename -}}

  {{- if strings.Contains $nameNoExt "--" -}}
    {{- $parts := split $nameNoExt "--" -}}
    {{- $name := index $parts 1 -}}
    {{- $section := .Page.Section -}}
    {{- $slug := .Page.File.ContentBaseName -}}
    {{- $src = printf "/%s/%s/%s.webp" $section $slug $name -}}
  {{- end -}}
{{- end -}}

<figure>
<img src="{{ $src | safeURL }}"
     alt="{{ .Text }}"
     loading="lazy"
     {{- with .Title }} title="{{ . }}"{{ end }}>
{{- with .Title }}
<figcaption>{{ . }}</figcaption>
{{- end }}
</figure>
